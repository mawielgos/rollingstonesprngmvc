(function(i){var e={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},l=function(a,b,c){return a[b]!==undefined?a[b]:c&&(a[b]={})},j=function(a){var b=typeof a;return a&&(b=="function"||b=="object")},m,k=i.String=i.extend(i.String||{},{getObject:m=function(a,b,c){a=a?a.split(e.dot):[];var f=a.length,d,h,g,n=0;b=i.isArray(b)?b:[b||window];if(f==0)return b[0];for(;d=b[n++];){for(g=0;g<f-1&&j(d);g++)d=l(d,a[g],
c);if(j(d)){h=l(d,a[g],c);if(h!==undefined){c===false&&delete d[a[g]];return h}}}},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1)},camelize:function(a){a=k.classize(a);return a.charAt(0).toLowerCase()+a.substr(1)},classize:function(a,b){a=a.split(e.undHash);for(var c=0;c<a.length;c++)a[c]=k.capitalize(a[c]);return a.join(b||"")},niceName:function(a){return k.classize(a," ")},underscore:function(a){return a.replace(e.colons,"/").replace(e.words,"$1_$2").replace(e.lowUp,"$1_$2").replace(e.dash,
"_").toLowerCase()},sub:function(a,b,c){var f=[];c=typeof c=="boolean"?!c:c;f.push(a.replace(e.replacer,function(d,h){d=m(h,b,c);if(j(d)){f.push(d);return""}else return""+d}));return f.length<=1?f[0]:f},_regs:e})})(jQuery);
(function(i){var j=false,p=i.makeArray,q=i.isFunction,l=i.isArray,m=i.extend,s=i.String.getObject,n=function(a,c){return a.concat(p(c))},t=/xyz/.test(function(){})?/\b_super\b/:/.*/,r=function(a,c,d){d=d||a;for(var b in a)d[b]=q(a[b])&&q(c[b])&&t.test(a[b])?function(h,g){return function(){var f=this._super,e;this._super=c[h];e=g.apply(this,arguments);this._super=f;return e}}(b,a[b]):a[b]};clss=i.Class=function(){arguments.length&&clss.extend.apply(clss,arguments)};m(clss,{proxy:function(a){var c=
p(arguments),d;a=c.shift();l(a)||(a=[a]);d=this;return function(){for(var b=n(c,arguments),h,g=a.length,f=0,e;f<g;f++)if(e=a[f]){if((h=typeof e=="string")&&d._set_called)d.called=e;b=(h?d[e]:e).apply(d,b||[]);if(f<g-1)b=!l(b)||b._use_call?[b]:b}return b}},newInstance:function(){var a=this.rawInstance(),c;if(a.setup)c=a.setup.apply(a,arguments);if(a.init)a.init.apply(a,l(c)?c:arguments);return a},setup:function(a){this.defaults=m(true,{},a.defaults,this.defaults);return arguments},rawInstance:function(){j=
true;var a=new this;j=false;return a},extend:function(a,c,d){function b(){if(!j)return this.constructor!==b&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}if(typeof a!="string"){d=c;c=a;a=null}if(!d){d=c;c=null}d=d||{};var h=this,g=this.prototype,f,e,k,o;j=true;o=new this;j=false;r(d,g,o);for(f in this)if(this.hasOwnProperty(f))b[f]=this[f];r(c,this,b);if(a){k=a.split(/\./);e=k.pop();k=g=s(k.join("."),window,true);g[e]=
b}m(b,{prototype:o,namespace:k,shortName:e,constructor:b,fullName:a});b.prototype.Class=b.prototype.constructor=b;e=b.setup.apply(b,n([h],arguments));if(b.init)b.init.apply(b,e||n([h],arguments));return b}});clss.callback=clss.prototype.callback=clss.prototype.proxy=clss.proxy})(jQuery);
(function(){var n=$.String,x=n.getObject,r=n.underscore,C=n.classize,w=$.isArray,y=$.makeArray,s=$.extend,j=$.each,l=function(a,b,c){$.event.trigger(b,c,a,true)},m=function(a,b,c,d,f,e,g){if(typeof a=="string"){var h=a.indexOf(" ");a=h>-1?{url:a.substr(h+1),type:a.substr(0,h)}:{url:a}}a.data=typeof b=="object"&&!w(b)?s(a.data||{},b):b;a.url=n.sub(a.url,a.data,true);return $.ajax(s({type:e||"post",dataType:g||"json",fixture:f,success:c,error:d},a))},o=function(a,b,c){var d=r(a.shortName),f="-"+d+(b||
"");return $.fixture&&$.fixture[f]?f:c||"//"+r(a.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+d+(b||"")+".json"},D=function(a,b,c){b=b||{};a=a.id;if(b[a]&&b[a]!==c){b["new"+n.capitalize(c)]=b[a];delete b[a]}b[a]=c;return b},z=function(a){return new (a||$.Model.List||Array)},t=function(a){return a[a.constructor.id]},E=function(a){var b=[];j(a,function(c,d){if(!d["__u Nique"]){b.push(d);d["__u Nique"]=1}});return j(b,function(c,d){delete d["__u Nique"]})},A=function(a,b,c,d,
f){var e=$.Deferred(),g=[a.serialize(),function(k){a[f||b+"d"](k);e.resolveWith(a,[a,k,b])},function(k){e.rejectWith(a,[k])}],h=a.constructor,i,p=e.promise();b=="destroy"&&g.shift();b!=="create"&&g.unshift(t(a));e.then(c);e.fail(d);if((i=h[b].apply(h,g))&&i.abort)p.abort=function(){i.abort()};return p},u=function(a){return typeof a==="object"&&a!==null&&a},q=function(a){return function(){return $.fn[a].apply($([this]),arguments)}},B=q("bind");q=q("unbind");ajaxMethods={create:function(a){return function(b,
c,d){return m(a||this._shortName,b,c,d,o(this,"Create","-restCreate"))}},update:function(a){return function(b,c,d,f){return m(a||this._shortName+"/{"+this.id+"}",D(this,c,b),d,f,o(this,"Update","-restUpdate"),"put")}},destroy:function(a){return function(b,c,d){var f={};f[this.id]=b;return m(a||this._shortName+"/{"+this.id+"}",f,c,d,o(this,"Destroy","-restDestroy"),"delete")}},findAll:function(a){return function(b,c,d){return m(a||this._shortName,b,c,d,o(this,"s"),"get","json "+this._shortName+".models")}},
findOne:function(a){return function(b,c,d){return m(a||this._shortName+"/{"+this.id+"}",b,c,d,o(this),"get","json "+this._shortName+".model")}}};jQuery.Class("jQuery.Model",{setup:function(a){var b=this,c=this.fullName;j(["attributes","validations"],function(f,e){if(!b[e]||a[e]===b[e])b[e]={}});j(["convert","serialize"],function(f,e){if(a[e]!=b[e])b[e]=s({},a[e],b[e])});this._fullName=r(c.replace(/\./g,"_"));this._shortName=r(this.shortName);if(c.indexOf("jQuery")!=0){if(this.listType)this.list=new this.listType([]);
j(ajaxMethods,function(f,e){var g=b[f];if(typeof g!=="function")b[f]=e(g)});c={};var d="* "+this._shortName+".model";c[d+"s"]=this.proxy("models");c[d]=this.proxy("model");$.ajaxSetup({converters:c})}},attributes:{},model:function(a){if(!a)return null;if(a instanceof this)a=a.serialize();return new this(u(a[this._shortName])||u(a.data)||u(a.attributes)||a)},models:function(a){if(!a)return null;var b=z(this.List),c=w(a),d=$.Model.List;d=d&&a instanceof d;for(var f=(d=c?a:d?a.serialize():a.data)?d.length:
null,e=0;e<f;e++)b.push(this.model(d[e]));c||j(a,function(g,h){if(g!=="data")b[g]=h});return b},id:"id",addAttr:function(a,b){var c=this.attributes;c[a]||(c[a]=b);return b},convert:{date:function(a){var b=typeof a;return b==="string"?isNaN(Date.parse(a))?null:Date.parse(a):b==="number"?new Date(a):a},number:function(a){return parseFloat(a)},"boolean":function(a){return Boolean(a==="false"?0:a)},"default":function(a,b,c){b=x(c);var d=window;if(c.indexOf(".")>=0){c=c.substring(0,c.lastIndexOf("."));
d=x(c)}return typeof b=="function"?b.call(d,a):a}},serialize:{"default":function(a){return u(a)&&a.serialize?a.serialize():a},date:function(a){return a&&a.getTime()}},bind:B,unbind:q,_ajax:m},{setup:function(a){this._init=true;this.attrs(s({},this.constructor.defaults,a));delete this._init},update:function(a,b,c){this.attrs(a);return this.save(b,c)},errors:function(a){if(a)a=w(a)?a:y(arguments);var b={},c=this,d=function(e,g){j(g,function(h,i){if(h=i.call(c)){b[e]||(b[e]=[]);b[e].push(h)}})},f=this.constructor.validations;
j(a||f||{},function(e,g){if(typeof e=="number"){e=g;g=f[e]}d(e,g||[])});return $.isEmptyObject(b)?null:b},attr:function(a,b,c,d){var f=C(a),e="get"+f;if(b!==undefined){f="set"+f;e=this[a];var g=this,h=function(i){d&&d.call(g,i);l(g,"error."+a,i)};if(this[f]&&(b=this[f](b,this.proxy("_updateProperty",a,b,e,c,h),h))===undefined)return;this._updateProperty(a,b,e,c,h);return this}return this[e]?this[e]():this[a]},bind:B,unbind:q,_updateProperty:function(a,b,c,d,f){var e=this.constructor,g=e.attributes[a]||
e.addAttr(a,"string"),h=e.convert[g]||e.convert["default"],i=null,p="",k="updated.";d=d;var v=e.list;b=this[a]=b===null?null:h.call(e,b,function(){},g);this._init||(i=this.errors(a));g=[b];h=[a,b,c];if(i){p=k="error.";d=f;h.splice(1,0,i);g.unshift(i)}if(c!==b&&!this._init){!i&&l(this,p+a,g);l(this,k+"attr",h)}d&&d.apply(this,g);if(a===e.id&&b!==null&&v)if(c){if(c!=b){v.remove(c);v.push(this)}}else v.push(this)},removeAttr:function(a){var b=this[a],c=false,d=this.constructor.attributes;this[a]&&delete this[a];
if(d[a]){delete d[a];c=true}!this._init&&c&&b&&l(this,"updated.attr",[a,null,b])},attrs:function(a){var b,c=this.constructor,d=c.attributes;if(a){c=c.id;for(b in a)b!=c&&this.attr(b,a[b]);c in a&&this.attr(c,a[c])}else{a={};for(b in d)if(d.hasOwnProperty(b))a[b]=this.attr(b)}return a},serialize:function(){var a=this.constructor,b=a.attributes,c,d,f={},e;attributes={};for(e in b)if(b.hasOwnProperty(e)){c=b[e];d=a.serialize[c]||a.serialize["default"];f[e]=d.call(a,this[e],c)}return f},isNew:function(){var a=
t(this);return a===undefined||a===null||a===""},save:function(a,b){return A(this,this.isNew()?"create":"update",a,b)},destroy:function(a,b){return A(this,"destroy",a,b,"destroyed")},identity:function(){var a=t(this),b=this.constructor;return(b._fullName+"_"+(b.escapeIdentity?encodeURIComponent(a):a)).replace(/ /g,"_")},elements:function(a){var b=this.identity();if(this.constructor.escapeIdentity)b=b.replace(/([ #;&,.+*~\'%:"!^$[\]()=>|\/])/g,"\\$1");return $("."+b,a)},hookup:function(a){var b=this.constructor._shortName,
c=$.data(a,"models")||$.data(a,"models",{});$(a).addClass(b+" "+this.identity());c[b]=this}});j(["created","updated","destroyed"],function(a,b){$.Model.prototype[b]=function(c){var d=this.constructor;b==="destroyed"&&d.list&&d.list.remove(t(this));c&&typeof c=="object"&&this.attrs(c.attrs?c.attrs():c);l(this,b);l(d,b,this);return[this].concat(y(arguments))}});$.fn.models=function(){var a=[],b,c;this.each(function(){j($.data(this,"models")||{},function(d,f){b=b===undefined?f.constructor.List||null:
f.constructor.List===b?b:null;a.push(f)})});c=z(b);c.push.apply(c,E(a));return c};$.fn.model=function(a){if(a&&a instanceof $.Model){a.hookup(this[0]);return this}else return this.models.apply(this,arguments)[0]}})(jQuery);
